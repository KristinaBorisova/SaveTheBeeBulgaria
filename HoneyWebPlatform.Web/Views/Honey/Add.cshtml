@model HoneyFormModel
@{
    ViewData["Title"] = "Добави Мед";
}

<h2 class="text-center">@ViewData["Title"]</h2>
<hr />

<partial name="_HoneyFormPartial" model="@Model" />

@section Scripts
{
    <partial name="_ValidationScriptsPartial" />

    <script>
        function updateFileName(input) {
            console.log('updateFileName called');
            console.log('input:', input);
            console.log('input.files:', input.files);
            
            if (input.files && input.files.length > 0) {
                var fileName = input.files[0].name;
                var fileSize = input.files[0].size;
                var maxSize = 2 * 1024 * 1024; // 2MB
                
                console.log('Selected file:', fileName, 'Size:', fileSize, 'bytes');
                
                var fileInfoElement = document.getElementById('upload-file-info');
                if (fileInfoElement) {
                    if (fileSize > maxSize) {
                        fileInfoElement.value = 'Файлът е твърде голям! Максимум 2MB';
                        fileInfoElement.style.color = 'red';
                        input.value = ''; // Clear the file input
                    } else {
                        fileInfoElement.value = fileName + ' (' + Math.round(fileSize / 1024) + ' KB)';
                        fileInfoElement.style.color = 'green';
                    }
                } else {
                    console.error('upload-file-info element not found');
                }
            } else {
                console.log('No file selected');
                var fileInfoElement = document.getElementById('upload-file-info');
                if (fileInfoElement) {
                    fileInfoElement.value = '';
                    fileInfoElement.style.color = '';
                }
            }
        }
        
        // Add event listener to ensure the function is called
        document.addEventListener('DOMContentLoaded', function() {
            var fileInput = document.getElementById('HoneyPicture');
            if (fileInput) {
                fileInput.addEventListener('change', function() {
                    updateFileName(this);
                });
            }
            
            // Add form validation feedback
            var form = document.querySelector('form[enctype="multipart/form-data"]');
            if (form) {
                form.addEventListener('submit', function(e) {
                    var errors = [];
                    
                    // Check file input
                    var fileInput = document.getElementById('HoneyPicture');
                    if (!fileInput.files || fileInput.files.length === 0) {
                        errors.push('Моля изберете снимка на меда!');
                    } else {
                        // Check file size
                        var file = fileInput.files[0];
                        var maxSize = 2 * 1024 * 1024; // 2MB
                        if (file.size > maxSize) {
                            errors.push('Файлът е твърде голям! Максималният размер е 2MB.');
                        }
                    }
                    
                    // Check required text fields
                    var title = document.querySelector('input[name="Title"]');
                    if (!title.value.trim()) {
                        errors.push('Моля въведете наименование!');
                    }
                    
                    var origin = document.querySelector('input[name="Origin"]');
                    if (!origin.value.trim()) {
                        errors.push('Моля въведете произход!');
                    }
                    
                    var description = document.querySelector('textarea[name="Description"]');
                    if (!description.value.trim()) {
                        errors.push('Моля въведете описание!');
                    }
                    
                    // Check NetWeight
                    var netWeight = document.querySelector('input[name="NetWeight"]');
                    if (!netWeight.value || parseInt(netWeight.value) <= 0) {
                        errors.push('Моля въведете валидно тегло!');
                    }
                    
                    // Check YearMade
                    var yearMade = document.querySelector('input[name="YearMade"]');
                    if (!yearMade.value || parseInt(yearMade.value) < 2020 || parseInt(yearMade.value) > 2024) {
                        errors.push('Моля въведете валидна година на производство (2020-2024)!');
                    }
                    
                    // Check Price
                    var price = document.querySelector('input[name="Price"]');
                    if (!price.value || parseFloat(price.value) <= 0) {
                        errors.push('Моля въведете валидна цена!');
                    }
                    
                    if (errors.length > 0) {
                        e.preventDefault();
                        alert('Моля поправете следните грешки:\n\n' + errors.join('\n'));
                        return false;
                    }
                });
            }
        });
    </script>

}
