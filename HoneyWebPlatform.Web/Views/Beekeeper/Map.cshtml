@model BeekeepersMapViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    ViewBag.Title = "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞ –Ω–∞ –ü—á–µ–ª–∞—Ä–∏";
}

<style>
    .map-container {
        width: 100%;
        height: 80vh;
        position: relative;
    }

    .map-filters {
        background: white;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        margin-bottom: 1.5rem;
    }

    .filter-row {
        display: flex;
        gap: 1rem;
        align-items: end;
        flex-wrap: wrap;
    }

    .filter-group {
        flex: 1;
        min-width: 200px;
    }

    .filter-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #333;
    }

    .filter-group select {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 1rem;
        background: white;
        cursor: pointer;
    }

    .filter-group select:hover {
        border-color: #F59F0A;
    }

    .search-btn {
        padding: 0.75rem 1.5rem;
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.3s;
    }

    .search-btn:hover {
        background: #5a6268;
    }

    .clear-filters-btn {
        padding: 0.75rem 1.5rem;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.3s;
    }

    .clear-filters-btn:hover {
        background: #c82333;
    }

    .beekeeper-info-window {
        padding: 1rem;
    }

    .beekeeper-info-window h3 {
        margin: 0 0 0.5rem 0;
        color: #F59F0A;
        font-size: 1.2rem;
    }

    .beekeeper-info-window p {
        margin: 0.25rem 0;
        color: #666;
    }

    .beekeeper-info-window p a {
        color: #F59F0A;
        text-decoration: underline;
        cursor: pointer;
        font-weight: normal;
        background: none;
        border: none;
        padding: 0;
        display: inline;
    }

    .beekeeper-info-window p a:hover {
        color: #f39c12;
        text-decoration: underline;
    }

    .beekeeper-info-window a {
        display: inline-block;
        margin-top: 0.75rem;
        padding: 0.5rem 1rem;
        background: #F59F0A;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        font-weight: 600;
        border: 1px solid transparent;
        transition: all 0.3s;
    }

    .beekeeper-info-window a:hover {
        background: white;
        color: #F59F0A;
        border: 1px solid #F59F0A;
    }

    .honey-types {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
        margin-top: 0.5rem;
    }

    .honey-type-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        background: #e8f5e9;
        color: #2e7d32;
        border-radius: 3px;
        font-size: 0.85rem;
    }

    #map {
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        width: 100%;
        height: 100%;
        min-height: 500px;
    }

    .map-page-container {
        padding: 2rem 0;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        min-height: 100vh;
    }

    .page-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .page-header h1 {
        font-size: 2.5rem;
        color: #333;
        margin-bottom: 0.5rem;
    }

    .page-header p {
        color: #666;
        font-size: 1.1rem;
    }

    @@media (max-width: 768px) {
        .filter-row {
            flex-direction: column;
        }

        .filter-group {
            min-width: 100%;
        }

        .page-header h1 {
            font-size: 2rem;
        }

        .map-container {
            height: 70vh;
        }
    }

    /* Recommendation Section Styles */
    .recommendation-section {
        margin-top: 3rem;
        padding: 2rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        max-width: 100%;
        box-sizing: border-box;
    }

    .recommendation-cta {
        text-align: center;
        padding: 0 1rem;
    }

    .recommendation-text {
        font-size: 1.2rem;
        color: #333;
        margin-bottom: 1.5rem;
        line-height: 1.7;
        font-weight: 400;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }

    .recommend-btn {
        padding: 1rem 2.5rem;
        background: #F59F0A;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 2px 5px rgba(245, 159, 10, 0.3);
        min-width: 200px;
        display: inline-block;
    }

    .recommend-btn:hover {
        background: #f39c12;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(245, 159, 10, 0.4);
    }

    .recommend-btn:active {
        transform: translateY(0);
    }

    .recommendation-form {
        margin-top: 2rem;
        padding: 2rem;
        background: #f8f9fa;
        border-radius: 10px;
        border: 2px solid #F59F0A;
        max-width: 100%;
        box-sizing: border-box;
    }

    .recommendation-form h3 {
        color: #F59F0A;
        margin-bottom: 1.5rem;
        font-size: 1.5rem;
        font-weight: 700;
        text-align: center;
    }

    .form-group {
        margin-bottom: 1.5rem;
        width: 100%;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #333;
        font-size: 1rem;
        line-height: 1.5;
    }

    .form-group input {
        width: 100%;
        padding: 1rem 1.125rem; /* Balanced padding: Top/bottom: 1rem (16px), Left/right: 1.125rem */
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 1rem; /* Standard font size */
        font-family: inherit;
        transition: all 0.3s;
        background: white;
        cursor: text;
        box-sizing: border-box;
        color: #333;
        min-height: 48px; /* Reduced to match dropdown height while ensuring text visibility */
        line-height: 1.5; /* Balanced line-height for proper text display */
        vertical-align: middle;
        overflow: visible; /* Ensure text is never clipped */
    }

    .form-group select {
        width: 100%;
        padding: 1rem 3rem 1rem 1.125rem; /* Balanced padding: top/bottom 1rem (16px), left 1.125rem, right 3rem for arrow */
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 1rem; /* Standard font size */
        font-family: inherit;
        transition: all 0.3s;
        background: white;
        cursor: pointer;
        box-sizing: border-box;
        color: #333;
        font-weight: 500;
        min-height: 48px; /* Reduced height but still ensures text visibility */
        height: auto; /* Allow height to adjust if needed */
        line-height: 1.5; /* Balanced line-height for proper text display */
        overflow: visible !important; /* Ensure text is never clipped */
        text-overflow: clip; /* Don't hide text, show it all */
        white-space: normal; /* Allow text to wrap if needed */
        /* Keep native appearance for better compatibility */
        -webkit-appearance: menulist;
        -moz-appearance: menulist;
        appearance: menulist;
    }

    /* Style for when no value is selected (placeholder) */
    .form-group select.placeholder-selected {
        color: #999;
        font-weight: normal;
        font-style: italic;
    }

    /* Style for when a value is selected */
    .form-group select.value-selected {
        color: #333;
        font-weight: 500;
        font-style: normal;
    }

    .form-group select option {
        color: #333;
        background: white;
        padding: 0.5rem;
    }

    .form-group select option:first-child {
        color: #999;
        font-style: italic;
    }

    .form-group select option:checked,
    .form-group select option[selected] {
        background: #F59F0A;
        color: white;
        font-weight: 600;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
        outline: none;
        border-color: #F59F0A;
        box-shadow: 0 0 0 3px rgba(245, 159, 10, 0.1);
    }

    .form-group select:hover {
        border-color: #F59F0A;
    }

    .form-group textarea {
        resize: vertical;
        min-height: 400px; /* Significantly increased height to ensure ALL text is visible */
        font-family: inherit;
        line-height: 2; /* Increased line spacing significantly to prevent text clipping */
        padding: 1.5rem; /* Significantly increased padding to 1.5rem (24px) for better text visibility */
        overflow-y: auto; /* Allow scrolling if content exceeds height */
        overflow-x: hidden; /* Prevent horizontal scrolling */
        vertical-align: top;
        font-size: 1.0625rem; /* Slightly larger font for better visibility */
    }

    .form-actions {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
        margin-top: 2rem;
        flex-wrap: wrap;
    }

    .submit-btn {
        padding: 0.875rem 2rem;
        background: #F59F0A;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        min-width: 140px;
        flex: 1;
        max-width: 200px;
    }

    .submit-btn:hover {
        background: #f39c12;
        transform: translateY(-1px);
        box-shadow: 0 2px 5px rgba(245, 159, 10, 0.3);
    }

    .submit-btn:active {
        transform: translateY(0);
    }

    .cancel-btn {
        padding: 0.875rem 2rem;
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        min-width: 140px;
        flex: 1;
        max-width: 200px;
    }

    .cancel-btn:hover {
        background: #5a6268;
        transform: translateY(-1px);
    }

    .cancel-btn:active {
        transform: translateY(0);
    }

    .text-danger {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.5rem;
        display: block;
        line-height: 1.4;
    }

    .validation-summary {
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 5px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        color: #856404;
    }

    /* Hide validation summary when it's valid (no errors) */
    .validation-summary.validation-summary-valid {
        display: none !important;
    }

    /* Only show validation summary when there are actual errors */
    .validation-summary:not(.validation-summary-valid) {
        display: block;
    }

    .validation-summary ul {
        margin: 0;
        padding-left: 1.5rem;
        list-style-type: disc;
    }

    .validation-summary li {
        margin-bottom: 0.5rem;
        line-height: 1.5;
    }

    .validation-summary li:last-child {
        margin-bottom: 0;
    }

    /* Responsive Design */
    @@media (max-width: 768px) {
        .recommendation-section {
            padding: 1.25rem;
            margin-top: 2rem;
        }

        .recommendation-cta {
            padding: 0;
        }

        .recommendation-text {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 1.25rem;
        }

        .recommend-btn {
            padding: 0.875rem 1.5rem;
            font-size: 1rem;
            min-width: auto;
            width: 100%;
            max-width: 300px;
        }

        .recommendation-form {
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .recommendation-form h3 {
            font-size: 1.25rem;
            margin-bottom: 1.25rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }

        .form-group input {
            padding: 0.875rem 1rem; /* Balanced padding for mobile: 14px top/bottom */
            font-size: 16px; /* Prevents zoom on iOS */
            border-width: 2px;
            min-height: 48px; /* Reduced to match dropdown height while ensuring text visibility on mobile */
            line-height: 1.5; /* Balanced line-height for proper text display */
            overflow: visible;
        }

        .form-group select {
            padding: 0.875rem 2.75rem 0.875rem 1rem; /* Balanced padding on mobile: 14px top/bottom */
            font-size: 16px; /* Prevents zoom on iOS */
            border-width: 2px;
            min-height: 48px; /* Reduced height but still ensures text visibility on mobile */
            height: auto; /* Allow height to adjust if needed */
            line-height: 1.5; /* Balanced line-height for proper text display */
            overflow: visible !important;
            white-space: normal;
        }

        .form-group textarea {
            min-height: 320px; /* Significantly increased for mobile to ensure ALL text is visible */
            padding: 1.25rem; /* Significantly increased padding for mobile */
            font-size: 16px; /* Prevents zoom on iOS */
            border-width: 2px;
            line-height: 2; /* Increased line spacing significantly */
        }

        .form-actions {
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .submit-btn,
        .cancel-btn {
            width: 100%;
            max-width: 100%;
            padding: 0.875rem 1.5rem;
        }

        .text-danger {
            font-size: 0.8125rem;
        }
    }

    @@media (max-width: 480px) {
        .recommendation-section {
            padding: 1rem;
            margin-top: 1.5rem;
        }

        .recommendation-text {
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .recommend-btn {
            padding: 0.75rem 1.25rem;
            font-size: 0.95rem;
        }

        .recommendation-form {
            padding: 1.25rem;
        }

        .recommendation-form h3 {
            font-size: 1.1rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 0.625rem;
            font-size: 16px;
        }
    }

    /* Improve touch targets for mobile */
    @@media (hover: none) and (pointer: coarse) {
        .recommend-btn,
        .submit-btn,
        .cancel-btn {
            min-height: 44px; /* Minimum touch target size */
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            min-height: 44px;
        }
    }

    /* Success Notification Pop-up */
    .success-notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
        padding: 1.5rem 2rem;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(40, 167, 69, 0.4);
        z-index: 10000;
        display: none;
        animation: slideInRight 0.3s ease-out;
        max-width: 400px;
        min-width: 300px;
    }

    .success-notification.show {
        display: block;
    }

    .success-notification-content {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .success-notification-icon {
        font-size: 2rem;
        flex-shrink: 0;
    }

    .success-notification-text {
        flex: 1;
    }

    .success-notification-title {
        font-weight: 700;
        font-size: 1.1rem;
        margin-bottom: 0.25rem;
    }

    .success-notification-message {
        font-size: 0.95rem;
        opacity: 0.95;
        line-height: 1.4;
    }

    .success-notification-close {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0.8;
        transition: opacity 0.3s;
        flex-shrink: 0;
    }

    .success-notification-close:hover {
        opacity: 1;
    }

    @@keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @@keyframes slideOutRight {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }

    .success-notification.hiding {
        animation: slideOutRight 0.3s ease-out forwards;
    }

    @@media (max-width: 768px) {
        .success-notification {
            top: 10px;
            right: 10px;
            left: 10px;
            max-width: none;
            min-width: auto;
            padding: 1.25rem 1.5rem;
        }

        .success-notification-title {
            font-size: 1rem;
        }

        .success-notification-message {
            font-size: 0.9rem;
        }
    }
</style>

<!-- Success Notification Pop-up -->
<div id="successNotification" class="success-notification">
    <div class="success-notification-content">
        <div class="success-notification-icon">‚úì</div>
        <div class="success-notification-text">
            <div class="success-notification-title">–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –≤–∏!</div>
            <div class="success-notification-message">–í–∞—à–∞—Ç–∞ –ø—Ä–µ–ø–æ—Ä—ä–∫–∞ –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ. –©–µ —Å–µ —Å–≤—ä—Ä–∂–µ–º —Å –≤–∞—Å —Å–∫–æ—Ä–æ.</div>
        </div>
        <button type="button" class="success-notification-close" onclick="hideSuccessNotification()" aria-label="Close">√ó</button>
    </div>
</div>

<div class="map-page-container">
    <div class="container">
        <div class="page-header">
            <h1>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞ –Ω–∞ –ü—á–µ–ª–∞—Ä–∏</h1>
            <p>–ù–∞–º–µ—Ä–µ—Ç–µ –º–∞–ª–∫–∏ –º–µ—Å—Ç–Ω–∏ –ø—á–µ–ª–∞—Ä–∏ –≤ –ë—ä–ª–≥–∞—Ä–∏—è –∏ –æ–ø–æ–∑–Ω–∞–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–∏—è –∏–º –º–µ–¥!</p>
        </div>

        <div class="map-filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="regionFilter">–§–∏–ª—Ç—Ä–∏—Ä–∞–π –ø–æ —Ä–µ–≥–∏–æ–Ω:</label>
                    <select id="regionFilter">
                        <option value="">–í—Å–∏—á–∫–∏ —Ä–µ–≥–∏–æ–Ω–∏</option>
                        <option value="–°–µ–≤–µ—Ä–æ–∑–∞–ø–∞–¥–µ–Ω">–°–µ–≤–µ—Ä–æ–∑–∞–ø–∞–¥–µ–Ω (–í—Ä–∞—Ü–∞, –ú–æ–Ω—Ç–∞–Ω–∞, –í–∏–¥–∏–Ω, –ü–ª–µ–≤–µ–Ω, –õ–æ–≤–µ—á)</option>
                        <option value="–°–µ–≤–µ—Ä–µ–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–µ–Ω">–°–µ–≤–µ—Ä–µ–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–µ–Ω (–†—É—Å–µ, –†–∞–∑–≥—Ä–∞–¥, –®—É–º–µ–Ω, –¢—ä—Ä–≥–æ–≤–∏—â–µ, –°–∏–ª–∏—Å—Ç—Ä–∞, –î–æ–±—Ä–∏—á)</option>
                        <option value="–°–µ–≤–µ—Ä–æ–∏–∑—Ç–æ—á–µ–Ω">–°–µ–≤–µ—Ä–æ–∏–∑—Ç–æ—á–µ–Ω (–í–∞—Ä–Ω–∞)</option>
                        <option value="–Æ–≥–æ–∑–∞–ø–∞–¥–µ–Ω">–Æ–≥–æ–∑–∞–ø–∞–¥–µ–Ω (–°–æ—Ñ–∏—è, –ü–µ—Ä–Ω–∏–∫, –ö—é—Å—Ç–µ–Ω–¥–∏–ª, –ë–ª–∞–≥–æ–µ–≤–≥—Ä–∞–¥)</option>
                        <option value="–Æ–∂–µ–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–µ–Ω">–Æ–∂–µ–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–µ–Ω (–ü–ª–æ–≤–¥–∏–≤, –ü–∞–∑–∞—Ä–¥–∂–∏–∫, –°–º–æ–ª—è–Ω, –ö—ä—Ä–¥–∂–∞–ª–∏, –•–∞—Å–∫–æ–≤–æ, –°—Ç–∞—Ä–∞ –ó–∞–≥–æ—Ä–∞)</option>
                        <option value="–Æ–≥–æ–∏–∑—Ç–æ—á–µ–Ω">–Æ–≥–æ–∏–∑—Ç–æ—á–µ–Ω (–ë—É—Ä–≥–∞—Å, –Ø–º–±–æ–ª)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="honeyFilter">–§–∏–ª—Ç—Ä–∏—Ä–∞–π –ø–æ –≤–∏–¥ –º–µ–¥:</label>
                    <select id="honeyFilter">
                        <option value="">–í—Å–∏—á–∫–∏ –≤–∏–¥–æ–≤–µ –º–µ–¥</option>
                        <option value="–ê–∫–∞—Ü–∏–µ–≤">–ê–∫–∞—Ü–∏–µ–≤ –º–µ–¥</option>
                        <option value="–õ–∏–ø–æ–≤">–õ–∏–ø–æ–≤ –º–µ–¥</option>
                        <option value="–°–ª—ä–Ω—á–æ–≥–ª–µ–¥–æ–≤">–°–ª—ä–Ω—á–æ–≥–ª–µ–¥–æ–≤ –º–µ–¥</option>
                        <option value="–ë–∏–ª–∫–æ–≤">–ë–∏–ª–∫–æ–≤ –º–µ–¥</option>
                    </select>
                </div>
                <div class="filter-group" style="flex: 0 0 auto; display: flex; gap: 0.5rem;">
                    <button type="button" class="search-btn" onclick="updateMapMarkers()">–¢—ä—Ä—Å–∏</button>
                    <button type="button" class="clear-filters-btn" onclick="clearFilters()">–ò–∑—á–∏—Å—Ç–∏ —Ñ–∏–ª—Ç—Ä–∏</button>
                </div>
            </div>
        </div>

        <div class="map-container">
            <div id="map" style="background: #e9ecef; display: flex; align-items: center; justify-content: center; color: #666;">
                Loading map...
            </div>
        </div>

        <!-- Beekeeper Recommendation Section -->
        <div class="recommendation-section">
            <div class="recommendation-cta">
                <p class="recommendation-text">
                    –ò—Å–∫–∞—à –ª–∏ –¥–∞ –Ω–∏ –ø–æ–º–æ–≥–Ω–µ—à –¥–∞ —Ä–∞–∑—à–∏—Ä–∏–º –∫–∞—Ä—Ç–∞—Ç–∞ —Å –ø–æ–≤–µ—á–µ –º–∞–ª–∫–∏ –º–µ—Å—Ç–Ω–∏ –ø—á–µ–ª–∞—Ä–∏? 
                    –ü—Ä–µ–ø–æ—Ä—ä—á–∞–π –Ω–∏ –ø—á–µ–ª–∞—Ä, –∞ –Ω–∏–µ —â–µ —Å–µ –ø–æ–≥—Ä–∏–∂–∏–º –∑–∞ –æ—Å—Ç–∞–Ω–∞–ª–æ—Ç–æ!
                </p>
                <button type="button" class="recommend-btn" onclick="toggleRecommendationForm()">
                    –ü—Ä–µ–ø–æ—Ä—ä—á–∞–π –ø—á–µ–ª–∞—Ä
                </button>
            </div>

            <div id="recommendationForm" class="recommendation-form" style="display: none;">
                <h3>–ü—Ä–µ–ø–æ—Ä—ä—á–∞–π –ø—á–µ–ª–∞—Ä</h3>
                <form asp-controller="Beekeeper" asp-action="RecommendBeekeeper" method="post" id="beekeeperRecommendationForm">
                    <div asp-validation-summary="All" class="validation-summary"></div>

                    <div class="form-group">
                        <label asp-for="RecommendationForm.BeekeeperName">–ò–º–µ –Ω–∞ –ø—á–µ–ª–∞—Ä *</label>
                        <input asp-for="RecommendationForm.BeekeeperName" class="form-control" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ—Ç–æ –Ω–∞ –ø—á–µ–ª–∞—Ä–∞" />
                        <span asp-validation-for="RecommendationForm.BeekeeperName" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="RecommendationForm.ContactNumber">–ù–æ–º–µ—Ä –∑–∞ –≤—Ä—ä–∑–∫–∞ *</label>
                        <input asp-for="RecommendationForm.ContactNumber" class="form-control" placeholder="+359..." />
                        <span asp-validation-for="RecommendationForm.ContactNumber" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="RecommendationForm.Region">–†–µ–≥–∏–æ–Ω *</label>
                        <select asp-for="RecommendationForm.Region" class="form-control" required onchange="updateSelectDisplay(this)">
                            <option value="">–ò–∑–±–µ—Ä–µ—Ç–µ —Ä–µ–≥–∏–æ–Ω</option>
                            <option value="–°–µ–≤–µ—Ä–æ–∑–∞–ø–∞–¥–µ–Ω">–°–µ–≤–µ—Ä–æ–∑–∞–ø–∞–¥–µ–Ω (–í—Ä–∞—Ü–∞, –ú–æ–Ω—Ç–∞–Ω–∞, –í–∏–¥–∏–Ω, –ü–ª–µ–≤–µ–Ω, –õ–æ–≤–µ—á)</option>
                            <option value="–°–µ–≤–µ—Ä–µ–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–µ–Ω">–°–µ–≤–µ—Ä–µ–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–µ–Ω (–†—É—Å–µ, –†–∞–∑–≥—Ä–∞–¥, –®—É–º–µ–Ω, –¢—ä—Ä–≥–æ–≤–∏—â–µ, –°–∏–ª–∏—Å—Ç—Ä–∞, –î–æ–±—Ä–∏—á)</option>
                            <option value="–°–µ–≤–µ—Ä–æ–∏–∑—Ç–æ—á–µ–Ω">–°–µ–≤–µ—Ä–æ–∏–∑—Ç–æ—á–µ–Ω (–í–∞—Ä–Ω–∞)</option>
                            <option value="–Æ–≥–æ–∑–∞–ø–∞–¥–µ–Ω">–Æ–≥–æ–∑–∞–ø–∞–¥–µ–Ω (–°–æ—Ñ–∏—è, –ü–µ—Ä–Ω–∏–∫, –ö—é—Å—Ç–µ–Ω–¥–∏–ª, –ë–ª–∞–≥–æ–µ–≤–≥—Ä–∞–¥)</option>
                            <option value="–Æ–∂–µ–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–µ–Ω">–Æ–∂–µ–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–µ–Ω (–ü–ª–æ–≤–¥–∏–≤, –ü–∞–∑–∞—Ä–¥–∂–∏–∫, –°–º–æ–ª—è–Ω, –ö—ä—Ä–¥–∂–∞–ª–∏, –•–∞—Å–∫–æ–≤–æ, –°—Ç–∞—Ä–∞ –ó–∞–≥–æ—Ä–∞)</option>
                            <option value="–Æ–≥–æ–∏–∑—Ç–æ—á–µ–Ω">–Æ–≥–æ–∏–∑—Ç–æ—á–µ–Ω (–ë—É—Ä–≥–∞—Å, –Ø–º–±–æ–ª)</option>
                        </select>
                        <span asp-validation-for="RecommendationForm.Region" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="RecommendationForm.NumberOfColonies">–ë—Ä–æ–π –ø—á–µ–ª–Ω–∏ —Å–µ–º–µ–π—Å—Ç–≤–∞</label>
                        <select asp-for="RecommendationForm.NumberOfColonies" class="form-control" onchange="updateSelectDisplay(this)">
                            <option value="">–ò–∑–±–µ—Ä–µ—Ç–µ –±—Ä–æ–π</option>
                            <option value="<10">–ü–æ-–º–∞–ª–∫–æ –æ—Ç 10</option>
                            <option value="<50">10-50</option>
                            <option value="<100">51-100</option>
                            <option value="100+">–ù–∞–¥ 100</option>
                        </select>
                        <span asp-validation-for="RecommendationForm.NumberOfColonies" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="RecommendationForm.RecommendationReason">–ó–∞—â–æ –Ω–∏ –ø—Ä–µ–ø–æ—Ä—ä—á–≤–∞—Ç–µ —Ç–æ–∑–∏ –º–µ–¥–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª? *</label>
                        <textarea asp-for="RecommendationForm.RecommendationReason" class="form-control" rows="8" placeholder="–†–∞–∑–∫–∞–∂–µ—Ç–µ –Ω–∏ –∑–∞—â–æ –ø—Ä–µ–ø–æ—Ä—ä—á–≤–∞—Ç–µ —Ç–æ–∑–∏ –ø—á–µ–ª–∞—Ä..."></textarea>
                        <span asp-validation-for="RecommendationForm.RecommendationReason" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="RecommendationForm.RecommenderName">–ö–æ–π –≥–æ –ø—Ä–µ–ø–æ—Ä—ä—á–≤–∞: –ò–º–µ *</label>
                        <input asp-for="RecommendationForm.RecommenderName" class="form-control" placeholder="–í–∞—à–µ—Ç–æ –∏–º–µ" />
                        <span asp-validation-for="RecommendationForm.RecommenderName" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="RecommendationForm.RecommenderEmail">–ò–º–µ–π–ª –∑–∞ –æ–±—Ä–∞—Ç–Ω–∞ –≤—Ä—ä–∑–∫–∞ *</label>
                        <input asp-for="RecommendationForm.RecommenderEmail" type="email" class="form-control" placeholder="your.email@example.com" />
                        <span asp-validation-for="RecommendationForm.RecommenderEmail" class="text-danger"></span>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="submit-btn">–ò–∑–ø—Ä–∞—Ç–∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∞</button>
                        <button type="button" class="cancel-btn" onclick="toggleRecommendationForm()">–û—Ç–∫–∞–∑</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Handle Google Maps API key
    const apiKey = '@Model.GoogleMapsApiKey';
    console.log('=== MAP DEBUG ===');
    console.log('API Key loaded:', apiKey ? 'YES (length: ' + apiKey.length + ')' : 'NO');
    console.log('API Key value:', apiKey);
    
    let mapsLoaded = false;

    if (apiKey && apiKey.trim() !== '') {
        console.log('Loading Google Maps script...');
        // Load Google Maps with API key
        const script = document.createElement('script');
        script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initMap&libraries=places`;
        script.async = true;
        script.defer = true;
        script.onload = function() {
            console.log('Google Maps script loaded successfully');
        };
        script.onerror = function() {
            console.error('Failed to load Google Maps script');
            document.getElementById('map').innerHTML = '<div style="padding: 2rem; text-align: center;"><p>Failed to load Google Maps. Please check your API key and browser console for errors.</p></div>';
        };
        document.head.appendChild(script);
    } else {
        console.log('No API key configured, showing placeholder');
        // Show a placeholder if no API key is configured
        document.getElementById('map').innerHTML = `
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f8f9fa; border-radius: 10px;">
                <div style="text-align: center; padding: 2rem;">
                    <h3>Google Maps API Key Required</h3>
                    <p>To use this interactive map, please configure your Google Maps API key.</p>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 1rem;">
                        Add <code>GoogleMaps:ApiKey</code> to your appsettings.json<br/>
                        or set the <code>GOOGLE_MAPS_API_KEY</code> environment variable.
                    </p>
                    <p style="font-size: 0.85rem; color: #999; margin-top: 0.5rem;">
                        Get your API key at: <a href="https://console.cloud.google.com/google/maps-apis" target="_blank">Google Cloud Console</a>
                    </p>
                </div>
            </div>
        `;
    }
</script>

<script>
    let map;
    let markers = [];
    let allBeekeepers = @Html.Raw(Json.Serialize(Model.Beekeepers));

    function initMap() {
        console.log('=== initMap() CALLED ===');
        console.log('Beekeepers count:', allBeekeepers.length);
        console.log('Map element exists:', document.getElementById('map') !== null);
        
        // Default center on Bulgaria
        map = new google.maps.Map(document.getElementById('map'), {
            mapId: '70f408e50f3bb9a450022c50', // Custom map style
            center: { lat: 42.7339, lng: 25.4858 },
            zoom: 7,
            mapTypeControl: true,
            mapTypeControlOptions: {
                style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
                position: google.maps.ControlPosition.TOP_RIGHT
            },
            streetViewControl: false,
            fullscreenControl: true
        });

        // Add markers for all beekeepers
        allBeekeepers.forEach(beekeeper => {
            // Create custom icon - location pin with bee
            const customIcon = {
                path: 'M12 0C5.373 0 0 5.373 0 12c0 8.016 12 20 12 20s12-11.984 12-20C24 5.373 18.627 0 12 0zm0 11c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z',
                fillColor: '#F59F0A',
                fillOpacity: 1,
                strokeColor: '#fff',
                strokeWeight: 2,
                scale: 1.5,
                anchor: new google.maps.Point(12, 20),
                labelOrigin: new google.maps.Point(12, 14)
            };

            const marker = new google.maps.Marker({
                position: { lat: beekeeper.latitude, lng: beekeeper.longitude },
                map: map,
                title: beekeeper.fullName,
                icon: customIcon,
                label: {
                    text: 'üêù',
                    fontSize: '14px',
                    fontWeight: 'bold'
                }
            });

            // Create info window
            const infoWindow = new google.maps.InfoWindow({
                content: createInfoWindowContent(beekeeper)
            });

            marker.addListener('click', () => {
                infoWindow.open(map, marker);
            });

            markers.push({
                marker: marker,
                beekeeper: beekeeper
            });
        });
    }

    function createInfoWindowContent(beekeeper) {
        const honeyTypesHtml = beekeeper.honeyTypes && beekeeper.honeyTypes.length > 0
            ? `<div class="honey-types">${beekeeper.honeyTypes.map(type => `<span class="honey-type-badge">${type}</span>`).join('')}</div>`
            : '';

        // Create Google Maps directions link (opens in directions/navigation mode) as clickable text
        const shopLocationHtml = beekeeper.shopLocation 
            ? `<p><strong>–õ–æ–∫–∞—Ü–∏—è:</strong> <a href="https://www.google.com/maps/dir/?api=1&destination=${beekeeper.latitude},${beekeeper.longitude}" target="_blank" style="color: #F59F0A; text-decoration: underline; cursor: pointer;">${escapeHtml(beekeeper.shopLocation)}</a></p>`
            : '';

        const profileLink = beekeeper.profileUrl && beekeeper.profileUrl.trim() !== '' 
            ? `<a href="${beekeeper.profileUrl}" class="profile-link">–í–∏–∂ –ø—Ä–æ—Ñ–∏–ª ‚Üí</a>`
            : '<p style="color: #999; font-size: 0.9rem;">–ü—Ä–æ—Ñ–∏–ª—ä—Ç –Ω–µ –µ –Ω–∞–ª–∏—á–µ–Ω</p>';

        return `
            <div class="beekeeper-info-window">
                <h3>${escapeHtml(beekeeper.fullName)}</h3>
                <p><strong>–†–µ–≥–∏–æ–Ω:</strong> ${escapeHtml(beekeeper.region || '–ë—ä–ª–≥–∞—Ä–∏—è')}</p>
                ${honeyTypesHtml}
                ${shopLocationHtml}
                ${profileLink}
            </div>
        `;
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // Filter functionality
    function updateMapMarkers() {
        const regionFilter = document.getElementById('regionFilter').value.toLowerCase();
        const honeyFilter = document.getElementById('honeyFilter').value.toLowerCase();

        markers.forEach(markerItem => {
            const beekeeper = markerItem.beekeeper;
            const regionMatch = !regionFilter || beekeeper.region?.toLowerCase().includes(regionFilter);
            const honeyMatch = !honeyFilter || 
                (beekeeper.honeyTypes && beekeeper.honeyTypes.some(type => 
                    type.toLowerCase().includes(honeyFilter)
                ));

            if (regionMatch && honeyMatch) {
                markerItem.marker.setVisible(true);
            } else {
                markerItem.marker.setVisible(false);
            }
        });

        // Adjust bounds to show visible markers
        const bounds = new google.maps.LatLngBounds();
        let hasVisibleMarkers = false;

        markers.forEach(markerItem => {
            if (markerItem.marker.getVisible()) {
                bounds.extend(markerItem.marker.getPosition());
                hasVisibleMarkers = true;
            }
        });

        if (hasVisibleMarkers) {
            map.fitBounds(bounds);
        } else {
            // If no markers visible, center on Bulgaria
            map.setCenter({ lat: 42.7339, lng: 25.4858 });
            map.setZoom(7);
        }
    }

    function clearFilters() {
        document.getElementById('regionFilter').value = '';
        document.getElementById('honeyFilter').value = '';
        updateMapMarkers();
    }

    // Note: Filters now require clicking "–¢—ä—Ä—Å–∏" button to apply
    // Event listeners removed to allow manual search trigger

    // Toggle recommendation form visibility
    function toggleRecommendationForm() {
        const form = document.getElementById('recommendationForm');
        if (form.style.display === 'none' || form.style.display === '') {
            form.style.display = 'block';
            form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        } else {
            form.style.display = 'none';
        }
    }

    // Update select display immediately when changed
    function updateSelectDisplay(selectElement) {
        if (!selectElement) return;
        
        const hasValue = selectElement.value && selectElement.value !== '';
        const selectedOption = selectElement.options[selectElement.selectedIndex];
        
        // Remove existing classes
        selectElement.classList.remove('placeholder-selected', 'value-selected');
        
        if (hasValue && selectedOption) {
            // Value is selected - show in dark text
            selectElement.classList.add('value-selected');
            selectElement.style.color = '#333';
            selectElement.style.fontWeight = '500';
            selectElement.style.fontStyle = 'normal';
            
            // Ensure the selected option text is visible
            // The native select should show this automatically, but we ensure it's styled correctly
            console.log('Selected value:', selectElement.value, 'Selected text:', selectedOption.text);
        } else {
            // No value selected - show placeholder style
            selectElement.classList.add('placeholder-selected');
            selectElement.style.color = '#999';
            selectElement.style.fontWeight = 'normal';
            selectElement.style.fontStyle = 'italic';
        }
    }

    // Initialize select displays on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Find select elements by their name attribute (ASP.NET generates name from asp-for)
        const regionSelect = document.querySelector('select[name*="Region"]');
        const coloniesSelect = document.querySelector('select[name*="NumberOfColonies"]');
        
        // Initialize both selects
        if (regionSelect) {
            updateSelectDisplay(regionSelect);
        }
        
        if (coloniesSelect) {
            updateSelectDisplay(coloniesSelect);
        }
        
        // Also update on form show
        const form = document.getElementById('recommendationForm');
        if (form) {
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                        if (form.style.display !== 'none') {
                            updateSelectDisplay(regionSelect);
                            updateSelectDisplay(coloniesSelect);
                        }
                    }
                });
            });
            observer.observe(form, { attributes: true, attributeFilter: ['style'] });
        }
    });

    // Show success notification
    function showSuccessNotification() {
        const notification = document.getElementById('successNotification');
        if (notification) {
            notification.classList.remove('hiding');
            notification.classList.add('show');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                hideSuccessNotification();
            }, 5000);
        }
    }

    // Hide success notification
    function hideSuccessNotification() {
        const notification = document.getElementById('successNotification');
        if (notification) {
            notification.classList.add('hiding');
            setTimeout(() => {
                notification.classList.remove('show', 'hiding');
            }, 300);
        }
    }

    // Check if form was submitted successfully (from TempData or ViewBag)
    document.addEventListener('DOMContentLoaded', function() {
        // Check for success message in URL
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('success') === 'true') {
            showSuccessNotification();
            // Clean URL
            window.history.replaceState({}, document.title, window.location.pathname);
        }
        
        // Also check if ViewBag.ShowSuccessNotification is set
        @if (ViewBag.ShowSuccessNotification == true)
        {
            <text>
            showSuccessNotification();
            </text>
        }
    });

    // Handle form submission success
    const form = document.getElementById('beekeeperRecommendationForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            // Form will submit normally, success will be handled by page reload with TempData
        });
    }
</script>

